library(tidyverse)
install.packages("pkgdown")
install.packages("textshaping", dependencies = TRUE)
library(tidyverse)
library(magrittr)
library(rlang)
library(data.tree)
library(optimx)       # minimizing optimizer function
library(philentropy)  # KL calculating function
library(xtable)
library(vtree)
library(tidyverse)
library(magrittr)
library(rlang)
library(data.tree)
library(optimx)       # minimizing optimizer function
library(philentropy)  # KL calculating function
library(xtable)
source("harmonic_syntax.R")
dt <- import_numeration("./numerations/basic_numeration.csv")
draw_tree2 <- function(my_tree){
feat_names <- c("case","foc","wh")
if(isLeaf(my_tree)){
# Leaf node
written <- paste0(my_tree$it,
case_when(my_tree$is_copy == 1 ~ "",
any(unlist(str_split(my_tree$ft, "-"))==1) ~ paste0("_f:", paste(feat_names[which(unlist(str_split(my_tree$ft, "-"))==1)], collapse = ",")),
T ~ ""),
case_when(my_tree$is_copy == 1 ~ "",
any(unlist(str_split(my_tree$ac, "-"))==1) ~ paste0("_a:", paste(feat_names[which(unlist(str_split(my_tree$ac, "-"))==1)], collapse = ",")),
T ~ ""))
} else {
# Non-leaf node
left_str <- draw_tree(my_tree$left_arg)
right_str <- draw_tree(my_tree$right_arg)
written <- paste0(ifelse(my_tree$it == 0, "",
ifelse(my_tree$is_copy == 1, paste0(my_tree$it,"c"), my_tree$it)),
case_when(my_tree$is_copy == 1 ~ "",
any(unlist(str_split(my_tree$ft, "-")) ==1) ~ paste0("_f:", paste(feat_names[which(unlist(str_split(my_tree$ft, "-"))==1)], collapse = ",")),
T ~ ""),
case_when(my_tree$is_copy == 1 ~ "",
any(unlist(str_split(my_tree$ac, "-"))==1) ~ paste0("_a:", paste(feat_names[which(unlist(str_split(my_tree$ac, "-"))==1)], collapse = ",")),
T ~ ""),
"[", left_str, " ", right_str,"]")
}
print(written)
}
Merge(dt[[1]]) %>% .[[1]]
Merge(dt[[1]]) %>% .[[1]] %T>% draw_tree2() %>%
Label()
Merge(dt[[1]]) %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2() %>%
Merge() %>% .[[1]] %T>% draw_tree2()
Merge(dt[[1]]) %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2() %>%
Merge() %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2()
Merge(dt[[1]]) %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2() %>%
Merge() %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2() %>% get_subtrees()
dt[[1]]$left_arg$lb
dt[[1]]$left_arg$lb %in% c(0)
library(tidyverse)
library(magrittr)
library(rlang)
library(data.tree)
library(optimx)       # minimizing optimizer function
library(philentropy)  # KL calculating function
library(xtable)
source("harmonic_syntax.R")
dt <- import_numeration("./numerations/basic_numeration.csv")
draw_tree2 <- function(my_tree){
feat_names <- c("case","foc","wh")
if(isLeaf(my_tree)){
# Leaf node
written <- paste0(my_tree$it,
case_when(my_tree$is_copy == 1 ~ "",
any(unlist(str_split(my_tree$ft, "-"))==1) ~ paste0("_f:", paste(feat_names[which(unlist(str_split(my_tree$ft, "-"))==1)], collapse = ",")),
T ~ ""),
case_when(my_tree$is_copy == 1 ~ "",
any(unlist(str_split(my_tree$ac, "-"))==1) ~ paste0("_a:", paste(feat_names[which(unlist(str_split(my_tree$ac, "-"))==1)], collapse = ",")),
T ~ ""))
} else {
# Non-leaf node
left_str <- draw_tree(my_tree$left_arg)
right_str <- draw_tree(my_tree$right_arg)
written <- paste0(ifelse(my_tree$it == 0, "",
ifelse(my_tree$is_copy == 1, paste0(my_tree$it,"c"), my_tree$it)),
case_when(my_tree$is_copy == 1 ~ "",
any(unlist(str_split(my_tree$ft, "-")) ==1) ~ paste0("_f:", paste(feat_names[which(unlist(str_split(my_tree$ft, "-"))==1)], collapse = ",")),
T ~ ""),
case_when(my_tree$is_copy == 1 ~ "",
any(unlist(str_split(my_tree$ac, "-"))==1) ~ paste0("_a:", paste(feat_names[which(unlist(str_split(my_tree$ac, "-"))==1)], collapse = ",")),
T ~ ""),
"[", left_str, " ", right_str,"]")
}
print(written)
}
# a function to extract subtrees of a tree, recursive, same label is skipped
get_subtrees <- function(input_tree, stash = integer()){
my_tree <- Clone(input_tree)
my_nodes <- list()
if (my_tree$isLeaf){ # if it is a leaf
if (my_tree$lb %in% stash){
# do nothing if the label is in stash
} else {
# update stash
stash %<>% append(my_tree$lb)
# return item if not in stash
return(my_nodes)
}
} else {
if (my_tree$lb %in% stash){
# do nothing if the label is in stash
} else {
# update stash
stash %<>% append(my_tree$lb)
# add new node
my_nodes %<>% append(Clone(my_tree)$Set(name = "left_arg", filterFun = isRoot))
}
if (my_tree$left_arg$lb %in% stash){
# do nothing if the label is in stash
} else {
# update stash
stash %<>% append(my_tree$left_arg$lb)
# add new node
my_nodes %<>% append(Clone(my_tree$left_arg)$Set(name = "left_arg", filterFun = isRoot))
}
if (my_tree$right_arg$lb %in% stash){
# do nothing if the label is in stash
} else {
# update stash
stash %<>% append(my_tree$right_arg$lb)
# add new node
my_nodes %<>% append(Clone(my_tree$right_arg)$Set(name = "left_arg", filterFun = isRoot))
}
return(append(my_nodes, get_subtrees(my_tree$left_arg, stash)) %>% append(get_subtrees(my_tree$right_arg, stash)))
}
}
Merge(dt[[1]]) %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2() %>%
Merge() %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2() %>% get_subtrees()
Merge(dt[[1]]) %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2() %>%
Merge() %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2() %>%
get_subtrees() %>% lapply(print("it"))
Merge(dt[[1]]) %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2() %>%
Merge() %>% .[[1]] %T>% draw_tree2() %>%
Label() %>% .[[1]] %T>% draw_tree2() %>%
get_subtrees() %>% lapply(function(x) print(x,"it"))
library(shiny); runApp('TabulatorInterface.R')
runApp('TabulatorInterface.R')
library(tidyverse)
library(magrittr)
library(rlang)
library(data.tree)
library(optimx)       # minimizing optimizer function
library(philentropy)  # KL calculating function
library(xtable)
source("harmonic_syntax.R")
eval_basic <- list.files(path = "./basic_numeration/", pattern = "*.rds$", full.names = T)[4] %>% readRDS() %>%
mutate(across(where(is.list), ~ map_chr(.x, as.character))) %>% mutate(der = "der_ext")
eval_unaccusative <- list.files(path = "./unaccusative_numeration/", pattern = "*.rds$", full.names = T)[4] %>% readRDS() %>%
mutate(across(where(is.list), ~ map_chr(.x, as.character))) %>% mutate(der = "der_unacc")
ewe_default <- list.files(path = "./ewe_numeration/", pattern = "*.rds$", full.names = T)[4] %>% readRDS() %>%
mutate(across(where(is.list), ~ map_chr(.x, as.character))) %>% mutate(der = "der_ewe_def")
ewe_matrix <- list.files(path = "./ewe_matrix/", pattern = "*.rds$", full.names = T)[4] %>% readRDS() %>%
mutate(across(where(is.list), ~ map_chr(.x, as.character))) %>% mutate(der = "der_ewe_mtr")
df_eval <- rbind(eval_basic, eval_unaccusative) %>%
rbind(ewe_default) %>% rbind(ewe_matrix) %>% mutate(input = paste(input, der)) %>% dplyr::select(-der)
if (!dir.exists("combined_numeration")){dir.create("combined_numeration")}
saveRDS(df_eval, "./combined_numeration/my_eval.rds")
combined_weights <- weight_optimize(df_eval, 4:22)
combined_weights <- tibble(weights = combined_weights$par) %>% t()
combined_weights
colnames(combined_weights) <- colnames(df_eval)[4:22]
combined_weights
saveRDS(combined_weights, "./combined_numeration/my_optimization.rds")
my_optimization <- "./combined_numeration/my_optimization.rds"
my_eval <- "./combined_numeration/my_eval.rds"
df_eval <- readRDS(my_eval) %>% mutate(across(where(is.list), ~ map_chr(.x, as.character)))
con_weights <- readRDS(my_optimization) %>% round() %>% as.numeric() %>% data.matrix() %>% t()
con_weights
my_calc <- df_eval[,4:22] %>% as.data.frame() %>% mutate_all(as.integer) %>% data.matrix()
df_eval$harmonies <- as.numeric(my_calc %*% con_weights)
con_weights
con_weights <- readRDS(my_optimization) %>% round() %>% as.numeric() %>% data.matrix()
my_calc <- df_eval[,4:22] %>% as.data.frame() %>% mutate_all(as.integer) %>% data.matrix()
df_eval$harmonies <- as.numeric(my_calc %*% con_weights)
bias <- 3
con_weights2 <- c(con_weights[1:9], con_weights[10:13]+bias, con_weights[14:16], con_weights[17:19]+bias)
df_eval$harmonies2 <- as.numeric(my_calc %*% con_weights2)
df_eval %<>% group_by(input) %>% mutate(min_1 = ifelse(min(harmonies) == harmonies,T,F),
min_2 = ifelse(min(harmonies2) == harmonies2,T,F),
is_changed = (min_1 != min_2)) %>% ungroup()
View(df_eval)
df_eval <- readRDS(my_eval) %>% mutate(across(where(is.list), ~ map_chr(.x, as.character)))
con_weights <- readRDS(my_optimization) %>% round() %>% as.numeric() %>% data.matrix()
my_calc <- df_eval[,4:22] %>% as.data.frame() %>% mutate_all(as.integer) %>% data.matrix()
df_eval$harmonies <- as.numeric(my_calc %*% con_weights)
bias <- 4
con_weights2 <- c(con_weights[1:9], con_weights[10:13]+bias, con_weights[14:16], con_weights[17:19]+bias)
df_eval$harmonies2 <- as.numeric(my_calc %*% con_weights2)
df_eval %<>% group_by(input) %>% mutate(min_1 = ifelse(min(harmonies) == harmonies,T,F),
min_2 = ifelse(min(harmonies2) == harmonies2,T,F),
is_changed = (min_1 != min_2)) %>% ungroup()
df_eval <- readRDS(my_eval) %>% mutate(across(where(is.list), ~ map_chr(.x, as.character)))
con_weights <- readRDS(my_optimization) %>% round() %>% as.numeric() %>% data.matrix()
my_calc <- df_eval[,4:22] %>% as.data.frame() %>% mutate_all(as.integer) %>% data.matrix()
df_eval$harmonies <- as.numeric(my_calc %*% con_weights)
bias <- 2
con_weights2 <- c(con_weights[1:9], con_weights[10:13]+bias, con_weights[14:16], con_weights[17:19]+bias)
df_eval$harmonies2 <- as.numeric(my_calc %*% con_weights2)
df_eval %<>% group_by(input) %>% mutate(min_1 = ifelse(min(harmonies) == harmonies,T,F),
min_2 = ifelse(min(harmonies2) == harmonies2,T,F),
is_changed = (min_1 != min_2)) %>% ungroup()
bias <- 3
con_weights2 <- c(con_weights[1:9], con_weights[10:13]+bias, con_weights[14:16], con_weights[17:19]+bias)
df_eval$harmonies2 <- as.numeric(my_calc %*% con_weights2)
df_eval %<>% group_by(input) %>% mutate(min_1 = ifelse(min(harmonies) == harmonies,T,F),
min_2 = ifelse(min(harmonies2) == harmonies2,T,F),
is_changed = (min_1 != min_2)) %>% ungroup()
